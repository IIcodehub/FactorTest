# config/settings.py
import os

# ==============================================================================
#                                 路径配置
# ==============================================================================
# 因子数据存储根目录 (存放 parquet 文件，程序会自动在此目录下创建年份文件夹)
FACTOR_DIR = r'./策略框架/data'

# 测试结果输出根目录 (存放 CSV, 图片, PDF 报告)
OUTPUT_DIR = r'./FactorTest/results'

# 因子数据库字段映射表路径 (Excel文件，定义了因子在数据库中的表名和字段名)
FACTOR_DICT_PATH = './因子框架/因子字典汇总.xlsx'

# 月份状态表路径 (Excel文件，用于按市场状态筛选月份，如牛熊市划分)
STATUS_DIR_PATH = '1602-2409月份状态滞后对应表.xlsx'

# ==============================================================================
#                                 自定义因子配置
# ==============================================================================
# 自定义因子文件路径
# 作用：若不为 None，程序将优先处理此文件，将其切分并覆盖 NAME_LIST 进行测试。
# 格式要求：parquet 或 csv，必须包含 'TradingDay' 和 'SecuCode' 列。
# FACTOR_ADD_PATH = r"./All_Factors.parquet" 
FACTOR_ADD_PATH = None

# 自定义因子在系统内部的名称
# 系统会将切分后的文件保存为: Factors_{CUSTOM_FACTOR_NAME}_all.parquet
# 且测试报告中的因子组名也会显示为这个名称
CUSTOM_FACTOR_NAME = 'CustomFactor'

# ==============================================================================
#                                 运行模式配置
# ==============================================================================
# 运行模式
# 'test': 执行因子回测（计算ICIR、分组收益、生成报告）
# 'save': 执行数据提取（从SQL数据库下载数据到本地 parquet）
MODE = 'test' 

# ==============================================================================
#                                 数据提取参数 (仅在 MODE='save' 时生效)
# ==============================================================================
# 数据更新范围
# 'factors': 仅更新因子数据
# 'pools':   仅更新股票池、行情、行业等基础数据
# 'all':     更新所有数据
FACTOR_ONLY = 'all'

# 待提取的因子大类列表
# 注意：若 FACTOR_ADD_PATH 不为 None，此列表会被自动忽略，直接使用 CUSTOM_FACTOR_NAME
NAME_LIST = ['alphafactor'] 
# 示例: NAME_LIST = ['Risk', 'Momentum']

# ==============================================================================
#                                 因子测试参数 (仅在 MODE='test' 时生效)
# ==============================================================================
# ------------------------------ 时间与范围 ------------------------------
# 回测起始日期列表 (支持多个起始日期并行测试)
# 格式: 'YYYY-MM-DD'
START_DATES = ['2022-01-01'] 

# 回测结束日期
END_DATE = '2025-06-30'

# 股票池列表 (支持并行测试)
# 可选值: 'all', '300', '500', '800', '1000', 'HighBeta1000', 'LowBeta1000' 等
STOCK_POOLS = ['all']

# ------------------------------ 收益率计算 ------------------------------
# 收益率基准指标
# 'Open5TWAP': 开盘后5分钟加权均价滞后2期收益率 (通常用于更真实的交易模拟)
# 'ClosePrice': 收盘价滞后1期收益率
RET_IDX = 'Open5TWAP'

# ------------------------------ 特殊情景测试 ------------------------------
# 异常日期或特定情景过滤
# None: 不进行过滤，跑全量数据
# 'rise': 仅测试暴涨区间
# 'V': 仅测试深V反转区间
# list: 传入多个 CSV 文件路径列表，每个文件定义一组有效日期 (文件需含 TradingDay 列)
ABN_DATES_TEST = None 
# 示例: ABN_DATES_TEST = ['./high_volatility.csv']

# 月份状态过滤
# 传入 list，例如 [-1, 1] 选择特定状态的月份；None 表示不筛选
MONTH_STATUS = None

# ------------------------------ 计算细节 ------------------------------
# 行业中性化
# True: 在行业内部对因子进行 Z-Score 标准化，并截断到 [-3, 3]
# False: 不进行行业中性化
IND_NEU = False

# 是否计算分组收益 (分层回测)
# True: 计算10分组收益曲线
GROUP_RET = True

# IC 计算方式
# True: 使用 RankIC (斯皮尔曼秩相关系数)
# False: 使用 IC (皮尔逊相关系数)
RANKIC = False

# 是否输出详细的 IC 每日序列文件
OUTPUT_IC = True

# ------------------------------ 系统配置 ------------------------------
# 并行计算最大线程数
# None: 自动使用 CPU 核心数
# int: 指定具体线程数 (如 4)
MAX_WORKERS = None